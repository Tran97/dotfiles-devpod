#!/bin/bash
set -e  # Exit on error

# Set up XDG directories
export XDG_CONFIG_HOME="$HOME/.config"
export XDG_DATA_HOME="$HOME/.local/share"

# Create necessary directories
mkdir -p "$XDG_CONFIG_HOME/nixpkgs"
mkdir -p "$XDG_CONFIG_HOME/nvim"
mkdir -p "$XDG_DATA_HOME/nvim"
mkdir -p "$XDG_DATA_HOME/ghostty"

# Copy configurations (not symlink)
if [ -d "nvim" ]; then
    echo "Persisting nvim config..."
    cp -r nvim/* "$XDG_CONFIG_HOME/nvim/"
fi

if [ -d "ghostty" ]; then
    echo "Persisting nvim config..."
    cp -r ghostty/* "$XDG_CONFIG_HOME/ghostty/"
fi

if [ -f "config.nix" ]; then
    echo "Persisting nix config..."
    cp config.nix "$XDG_CONFIG_HOME/nixpkgs/config.nix"
fi

# Install Nix packages
echo "Installing Nix packages..."
nix-env -iA nixpkgs.myPackages

# Verify installations
echo "Verifying installations..."
command -v nvim >/dev/null 2>&1 && echo "nvim installed successfully" || echo "nvim installation failed"
